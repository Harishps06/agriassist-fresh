<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather & Calendar Test</title>
    <script src="js/config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üå§Ô∏è Weather & Calendar Test</h1>
    
    <div class="test-section">
        <h2>Weather Service Test</h2>
        <button onclick="testWeatherService()">Test Weather API</button>
        <div id="weather-result"></div>
    </div>

    <div class="test-section">
        <h2>Calendar Service Test</h2>
        <button onclick="testCalendarService()">Test Calendar</button>
        <div id="calendar-result"></div>
    </div>

    <div class="test-section">
        <h2>Configuration Test</h2>
        <button onclick="testConfiguration()">Test Config</button>
        <div id="config-result"></div>
    </div>

    <script>
        // Weather Service Test
        class WeatherService {
            constructor() {
                const config = window.AgriAssistConfig.getConfig();
                this.apiKey = config.apis.weather.apiKey;
                this.baseUrl = `${config.apis.weather.baseUrl}/weather`;
                this.location = { lat: 10.8505, lon: 76.2711 };
            }

            async getCurrentWeather() {
                try {
                    if (this.apiKey === 'YOUR_WEATHER_API_KEY') {
                        throw new Error('API key not configured');
                    }
                    const response = await fetch(`${this.baseUrl}?lat=${this.location.lat}&lon=${this.location.lon}&appid=${this.apiKey}&units=metric`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    return this.getFallbackWeather();
                }
            }

            getFallbackWeather() {
                return {
                    main: { temp: 28, humidity: 75 },
                    weather: [{ description: 'Partly cloudy', icon: '02d' }],
                    wind: { speed: 12 },
                    name: 'Kerala'
                };
            }
        }

        // Calendar Service Test
        class AgriculturalCalendarService {
            getKeralaSeasons() {
                const currentDate = new Date();
                const month = currentDate.getMonth() + 1;
                
                if (month >= 6 && month <= 10) {
                    return { name: 'Kharif Season', description: 'Monsoon season - Rice planting' };
                } else if (month >= 11 || month <= 2) {
                    return { name: 'Rabi Season', description: 'Winter season - Wheat and pulses' };
                } else {
                    return { name: 'Summer Season', description: 'Hot season - Mango and cashew' };
                }
            }
        }

        async function testWeatherService() {
            const resultDiv = document.getElementById('weather-result');
            resultDiv.innerHTML = 'Testing weather service...';
            
            try {
                const weatherService = new WeatherService();
                const weather = await weatherService.getCurrentWeather();
                
                resultDiv.className = 'test-section success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Weather Service Working</h3>
                    <p><strong>Location:</strong> ${weather.name}</p>
                    <p><strong>Temperature:</strong> ${Math.round(weather.main.temp)}¬∞C</p>
                    <p><strong>Description:</strong> ${weather.weather[0].description}</p>
                    <p><strong>Humidity:</strong> ${weather.main.humidity}%</p>
                    <p><strong>Wind:</strong> ${Math.round(weather.wind.speed * 3.6)} km/h</p>
                `;
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = `<h3>‚ùå Weather Service Error</h3><p>${error.message}</p>`;
            }
        }

        function testCalendarService() {
            const resultDiv = document.getElementById('calendar-result');
            resultDiv.innerHTML = 'Testing calendar service...';
            
            try {
                const calendarService = new AgriculturalCalendarService();
                const season = calendarService.getKeralaSeasons();
                const currentDate = new Date();
                
                resultDiv.className = 'test-section success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Calendar Service Working</h3>
                    <p><strong>Current Date:</strong> ${currentDate.toLocaleDateString('en-IN')}</p>
                    <p><strong>Current Season:</strong> ${season.name}</p>
                    <p><strong>Description:</strong> ${season.description}</p>
                    <p><strong>Month:</strong> ${currentDate.toLocaleDateString('en-IN', { month: 'long' })}</p>
                `;
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = `<h3>‚ùå Calendar Service Error</h3><p>${error.message}</p>`;
            }
        }

        function testConfiguration() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = 'Testing configuration...';
            
            try {
                const config = window.AgriAssistConfig.getConfig();
                
                resultDiv.className = 'test-section success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Configuration Working</h3>
                    <p><strong>Environment:</strong> ${config.environment}</p>
                    <p><strong>API Base URL:</strong> ${config.api.baseUrl}</p>
                    <p><strong>Weather API Key:</strong> ${config.apis.weather.apiKey.substring(0, 10)}...</p>
                    <p><strong>Features Enabled:</strong> ${Object.keys(config.features).filter(f => config.features[f]).join(', ')}</p>
                `;
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = `<h3>‚ùå Configuration Error</h3><p>${error.message}</p>`;
            }
        }

        // Auto-run tests on page load
        window.onload = function() {
            testConfiguration();
            testCalendarService();
            testWeatherService();
        };
    </script>
</body>
</html>
